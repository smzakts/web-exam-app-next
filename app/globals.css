/* app/globals.css */

/* === Theme tokens === */
:root {
  color-scheme: dark;
  --bg: #0e1116;
  --surface: #141a22;
  --surface-2: #171e27;
  --line: #243244;
  --muted: #9db3c7;
  --text: #e6f0fa;
  --accent: #58a6ff;
  --accent-2: #7ee787;
  --danger: #ff7b72;
  --shadow: 0 10px 30px rgba(0,0,0,.35);
  --radius: 14px;

  --page-pad: 14px;
  --col-gap: 14px;            /* 列ギャップ（トグル位置計算にも使用） */
  --sidebar-w: 340px;         /* React が 340px / 50vw / 0px を上書き */
  --header-h: 60px;
}

* { box-sizing: border-box; }
html, body { height: 100%; }
html, body { overflow: hidden; }   /* 全体は固定。カード内のみスクロール */

body {
  margin: 0;
  -webkit-text-size-adjust: 100%;
  -webkit-tap-highlight-color: transparent;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, 'Noto Sans JP', 'Hiragino Kaku Gothic ProN', 'Yu Gothic', Meiryo, sans-serif;
  background:
    radial-gradient(1200px 600px at 80% -10%, rgba(80,130,255,.12), transparent 60%),
    radial-gradient(900px 500px at -10% 100%, rgba(126,231,135,.08), transparent 60%),
    var(--bg);
  color: var(--text);
}

/* === Buttons === */
button {
  font-size: .95rem;
  padding: 10px 14px;
  cursor: pointer;
  background: radial-gradient(150% 150% at 30% 15%, rgba(88,166,255,.18), transparent 50%), linear-gradient(180deg, #1b2735, #15202b);
  color: var(--text);
  border: 1px solid #2a3b50;
  border-radius: 12px;
  transition: transform .08s ease, background .2s ease, border-color .2s ease, box-shadow .2s ease;
  box-shadow: 0 2px 0 rgba(0,0,0,.35);
  touch-action: manipulation;
}
button:hover { background: radial-gradient(150% 150% at 30% 15%, rgba(88,166,255,.22), transparent 50%), linear-gradient(180deg, #223043, #172433); border-color: #355072; box-shadow: 0 0 0 3px rgba(88,166,255,.15); }
button:active { transform: translateY(1px); }
button.ghost { background: transparent; border-color: #2a3b50; }
button.ghost:hover { background: #141e27; border-color: #355072; }

select {
  background: #0f1620;
  color: var(--text);
  border: 1px solid #2a3b50;
  border-radius: 10px;
  padding: 8px 10px;
}

/* === TOC（目次） === */
.toc-container { max-width: 980px; margin: 48px auto; padding: 0 18px; }
.toc-title { font-size: 2.1rem; font-weight: 800; letter-spacing: .02em; margin: 0 0 20px; }
.toc-card { background: linear-gradient(180deg, #121821, #0e141c); border: 1px solid var(--line); border-radius: var(--radius); box-shadow: var(--shadow); overflow: hidden; }
.toc-list { list-style: none; margin: 0; padding: 0; }
.toc-item a {
  display: flex; align-items: center; justify-content: space-between;
  gap: 16px; padding: 18px 20px;
  text-decoration: none; color: var(--text);
  border-bottom: 1px solid #1e2a39;
  transition: background .15s ease, transform .08s ease, padding-left .15s ease, box-shadow .15s ease;
}
.toc-item:last-child a { border-bottom: none; }
.toc-item a:hover { background: #0f1620; padding-left: 24px; transform: translateY(-1px); box-shadow: inset 0 0 0 1px #203046; }

/* === 固定ヘッダー === */
.global-header {
  position: fixed;
  inset: 0 0 auto 0;
  height: var(--header-h);
  z-index: 1000;
  pointer-events: none;
}
.global-header .bar {
  pointer-events: auto;
  height: 100%;
  margin: 0 auto;
  padding: 0 var(--page-pad);
  display: flex; align-items: center; gap: 10px;
  background: #0f1620;
  border-bottom: 1px solid var(--line);
  box-shadow: 0 6px 24px rgba(0,0,0,.25);
}
.global-header .title {
  font-weight: 800; letter-spacing: .02em;
  padding: 8px 12px; border-radius: 10px;
  background: #101722; border: 1px solid #223245;
}

/* === レイアウト（100dvh優先） === */
.page-shell {
  display: grid;
  grid-template-columns: var(--sidebar-w) 1fr;      /* ← React が 340px / 50vw / 0px をセット */
  grid-template-rows: calc(100vh - var(--header-h));/* フォールバック */
  gap: var(--col-gap);
  padding: calc(var(--page-pad) + var(--header-h)) var(--page-pad) var(--page-pad);
}
@supports(height: 100dvh) {
  .page-shell {
    grid-template-rows: calc(100dvh - var(--header-h)); /* iOSのUI伸縮でも高さが安定 */
  }
}

/* --- 左サイドバー --- */
.sidebar {
  display: flex;
  flex-direction: column;
  background: linear-gradient(180deg, #0e141c, #0c1219);
  border: 1px solid var(--line);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  overflow: hidden;
  min-width: 0;
  transition: opacity .3s ease;
  opacity: 1;
}
.sidebar.hidden { opacity: 0; pointer-events: none; }
.sidebar-head { display: flex; align-items: center; justify-content: space-between; gap: 10px; padding: 12px; border-bottom: 1px solid #1b2735; background: #0f1620; }
.sidebar-title { font-weight: 700; letter-spacing: .02em; }

/* === サイドバー開閉（« / »） === */
.sidebar-toggle {
  position: fixed;
  top: 50%;
  transform: translateY(-50%);
  z-index: 1200;
  width: 40px; height: 40px; padding: 0;
  border-radius: 50%;
  border: 1px solid rgba(230, 240, 250, 0.35);
  background: #0f1620;
  box-shadow: 0 6px 14px rgba(0,0,0,.3), inset 0 0 8px rgba(88,166,255,.2);
  color: #e6f0fa;
  font-weight: 900; font-size: 26px; line-height: 1;
  display: flex; align-items: center; justify-content: center;
  text-align: center; cursor: pointer;
  transition: left .4s ease, box-shadow .25s ease, background .25s ease, border-color .25s ease, transform .06s ease;
}
.sidebar-toggle:hover { border-color: rgba(88,166,255,0.55); box-shadow: 0 8px 18px rgba(0,0,0,.45), 0 0 0 3px rgba(88,166,255,.15), inset 0 0 10px rgba(88,166,255,.25); }
.sidebar-toggle:active { transform: translateY(-50%) scale(0.96); }
/* ギャップ中央（円の中心が境界） */
.sidebar-toggle.at-boundary { left: calc(var(--page-pad) + var(--sidebar-w) + (var(--col-gap) / 2) - 20px); }
.sidebar-toggle.at-left     { left: calc(var(--page-pad) + 10px); }

/* === スコア＆履歴（デフォルト） === */
.score { display: flex; align-items: center; gap: 10px; padding: 10px 12px; border-bottom: 1px solid #1b2735; }
.score .value { font-weight: 800; color: var(--accent-2); }
.history { flex: 1; overflow: auto; }
.history table { width: 100%; border-collapse: collapse; table-layout: auto; }
.history th, .history td {
  border-bottom: 1px solid #1a2633;
  text-align: center;
  padding: 8px 6px;
  font-size: .92rem;
  white-space: nowrap;
}
.history thead th { position: sticky; top: 0; background: #0f1620; z-index: 1; }
.history td.clickable { color: #9bd1ff; cursor: pointer; }
.history td.clickable:hover { text-decoration: underline; }
.history tr.current { background: linear-gradient(180deg, rgba(16, 23, 34, .98), rgba(10, 16, 23, .98)); box-shadow: inset 0 0 0 1px #3a5f88, inset 4px 0 0 var(--accent); }
.history tr.current td:first-child { font-weight: 900; letter-spacing: .02em; color: #d7ecff; text-shadow: 0 0 6px rgba(88,166,255,.35); }

/* --- 右カラム（上下 1:1 固定） --- */
.main {
  display: grid;
  grid-template-rows: 1fr 1fr;    /* ← 上：問題、下：選択肢 を必ず半々に */
  min-width: 0;
}

/* 問題カード（上半分） */
.question-card {
  background: linear-gradient(180deg, #0d131b, #0a1017);
  border: 1px solid var(--line);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding: 14px;
  overflow: auto;                 /* 内部スクロール */
  min-height: 0;                  /* grid子の縮み許可（重要） */
  scrollbar-width: none; -ms-overflow-style: none;
}
.question-card::-webkit-scrollbar { display: none; }
.question-text { font-size: 1.16rem; line-height: 1.7; margin: 0 0 12px; white-space: pre-wrap; }
.question-image { width: 100%; max-height: 100%; object-fit: contain; margin-top: 10px; border-radius: 12px; border: 1px solid #1e2a39; background: #0b1118; }

/* 選択肢カード（下半分） */
.choices-card {
  background: linear-gradient(180deg, #0d131b, #0a1017);
  border: 1px solid var(--line);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding: 10px;
  overflow: auto;                 /* 内部スクロール */
  min-height: 0;                  /* 重要：半分に収まる */
  scrollbar-width: none; -ms-overflow-style: none;
}
.choices-card::-webkit-scrollbar { display: none; }

/* ○×ボタン */
.tf-row { display: flex; align-items: center; gap: 10px; padding: 4px 0; }
.big-choice-btn {
  height: 44px; min-width: 66px; padding: 0 16px;
  border-radius: 999px; font-weight: 900; letter-spacing: .06em; font-size: 1rem;
  background: radial-gradient(180% 180% at 25% 20%, rgba(255,255,255,.12), transparent 50%), linear-gradient(180deg, #1d2d3f, #142433);
  border: 1px solid #3a597e; box-shadow: 0 10px 24px rgba(0,0,0,.25), inset 0 0 10px rgba(255,255,255,.06);
}
.big-choice-btn:hover { border-color: #5a8bc6; box-shadow: 0 0 0 4px rgba(88,166,255,.15), inset 0 0 14px rgba(255,255,255,.08); }

/* 択一の1行 */
.choice-row {
  display: grid; grid-template-columns: 74px 1fr; gap: 10px;
  align-items: center; padding: 8px 10px; border-radius: 12px;
  cursor: pointer; transition: background .15s ease, border-color .15s ease, transform .06s ease;
}
.choice-row:hover { background: #0f1620; }
.choice-row:active { transform: translateY(1px); }
.choice-chip {
  height: 40px; min-width: 64px; padding: 0 12px;
  display: inline-flex; align-items: center; justify-content: center;
  border-radius: 999px; font-weight: 900; letter-spacing: .06em; font-size: .98rem;
  color: #e6f0fa;
  background: radial-gradient(180% 180% at 25% 20%, rgba(255,255,255,.12), transparent 50%),
              linear-gradient(180deg, #1d2d3f, #142433);
  border: 1px solid #3a597e; box-shadow: inset 0 0 10px rgba(255,255,255,.06);
}
.choice-text { color: var(--text); }

/* ======== モバイル最適化：iPhone等でもサイドバー4列を表示する ======== */

/* 860px以下：やや圧縮（タブレット縦～大きめスマホ） */
@media (max-width: 860px) {
  .history table { table-layout: fixed; }                 /* 列幅を固定配分 */
  .history th, .history td { font-size: 0.85rem; padding: 6px 4px; }
  .history th:nth-child(1), .history td:nth-child(1) { width: 18%; } /* No   */
  .history th:nth-child(2), .history td:nth-child(2) { width: 22%; } /* 選択 */
  .history th:nth-child(3), .history td:nth-child(3) { width: 28%; } /* 判定 */
  .history th:nth-child(4), .history td:nth-child(4) { width: 32%; } /* 解答 */
}

/* 430px以下：さらに圧縮（iPhone 12 Pro Max 縦 428px 程度を想定） */
@media (max-width: 430px) {
  .history th, .history td { font-size: 0.78rem; padding: 5px 3px; }
  .history th:nth-child(1), .history td:nth-child(1) { width: 16%; }
  .history th:nth-child(2), .history td:nth-child(2) { width: 22%; }
  .history th:nth-child(3), .history td:nth-child(3) { width: 30%; }
  .history th:nth-child(4), .history td:nth-child(4) { width: 32%; }
}

/* 380px以下：最小端末向け（SE等） */
@media (max-width: 380px) {
  .history th, .history td { font-size: 0.72rem; padding: 4px 2px; }
  .history th:nth-child(1), .history td:nth-child(1) { width: 16%; }
  .history th:nth-child(2), .history td:nth-child(2) { width: 22%; }
  .history th:nth-child(3), .history td:nth-child(3) { width: 30%; }
  .history th:nth-child(4), .history td:nth-child(4) { width: 32%; }
}
